<!DOCTYPE HTML>
<!--
	Editorial by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
<title>코다리</title>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
<link rel="shortcut icon" href="img/favicon.ico" />
<link rel="icon" href="img/favicon.ico" />
<link rel="stylesheet" href="/assets/css/main.css" />
<style type="text/css">
@import url("/css/fackfont.css");
.legend {
	border: 1px solid #555555;
	border-radius: 5px 5px 5px 5px;
	font-size: 0.8em;
	margin: 10px;
	padding: 8px;
}

.bld {
	font-weight: bold;
}
.wordcloud {
	margin: 0 auto;
	display: block;
	font-family: "Lucida Grande", "Droid Sans", Arial, Helvetica, sans-serif;
}
#btn1 {
	float: right;
}
.containers {
	text-align: center;
}
#covidInfo {
	width: 75%;
	margin: auto;
}			 
.content {
	text-align: center;
}

#localInfo {
	float: right;
}
</style>
<script src="https://d3js.org/d3.v3.min.js"></script>
<script src="/js/d3/1.2.5/d3.layout.cloud.js"></script>
<script src="/js/jQuery/jquery-3.5.1.js" type="text/javascript"></script>
</head>
<body class="is-preload">

	<!-- Wrapper -->
	<div id="wrapper">

		<!-- Main -->
		<div id="main">
			<div class="inner">

				<!-- Header -->
				<header id="header">
					<a href="#" class="logo"><strong>코</strong>로나 정보, <strong>다</strong> <strong>이</strong>곳</a>
					<ul th:if ="${session.userLoginInfo != null}" class="icons">
						<li><span th:text="${session.userLoginInfo.user_nickname}"></span>님, 환영합니다.&nbsp;&nbsp;<a th:href = "@{/member/logoutProcess}" class="button small">로그아웃</a></li>
					</ul>
				</header>

				<!-- Banner -->
				<section id="banner">
					<div class="content">
						<header>
							<h1>코로나 현황판</h1>
						</header>
						<div id="covidInfo">
						</div>
						<ul class="actions">
							<li><a id="localInfo" href="/covid/covidDetail" class="button big">지역별 현황</a></li>
						</ul>
					</div>
				</section>
				
				<!-- Section -->
				<section>
					<header style="text-align: center;" class="major">
						<h2>실시간 네이버 뉴스 태그 빈도</h2>
					</header>
					<div class="content">
						<div style="text-align: center;" class="legend">Commonly used words are larger and slightly faded in color. Less common words are smaller and darker.
						<br>높은 빈도의 단어는 더 크고 색이 약간 희미합니다. 단어가 쓰여진 빈도가 작을수록 더 작고 진합니다.
						</div>
						<input id="btn1" type="button" class="show" value="보여주기">
						<div id="desc"></div>
						<br><br>
						<div class="containers">
							<div style="width: 60%;">
								<div class="wordCloud1" id="wordCloud2"></div>
							</div>
						</div>
						<br><br>
					</div>
				</section>
			</div>
		</div>

		<!-- Sidebar -->
		<div id="sidebar">
			<div class="inner">
				<!-- Menu -->
				<nav id="menu">
					<header class="major">
						<h2>Menu</h2>
					</header>
					<ul>
						<li><a href="/">Homepage</a></li>
						<li><a href="/notice/noticeList.do">공지사항</a></li>
						<li><span class="opener">정보</span>
							<ul>
								<li><a href="/fact/factCheck">Fact Check</a></li>
								<li><a href="/board/boardAll.do">정보 공유</a></li>
								<li><a href="/covid/covidHospitalHome.do">실시간 병원 정보</a></li>
							</ul>
						</li>
						<li th:if="${session.userLoginInfo != null}"><a th:href="@{/member/myPage.do}">마이페이지</a></li>
						<li th:if="${session.userLoginInfo == null}"><a th:href="@{/member/login}">로그인 페이지</a></li>
						<li th:if="${session.userLoginInfo == null}"><a th:href="@{/member/register}">회원 가입</a></li>
						<li th:if="${session.userLoginInfo != null && session.userLoginInfo.user_role == 'admin'}"><span class="opener">관리자 페이지</span>
							<ul>
								<li><a href="/member/memberAll.do">유저 목록</a></li>
							</ul>
						</li>
					</ul>
				</nav>


				<!-- Section -->
				<section>
					<header class="major">
						<h2>Contact Us</h2>
					</header>
					<p>문의 사항이 있다면 아래의 수단 중 하나로 문의해 주세요.</p>
					<ul class="contact">
						<li class="icon solid fa-envelope"><a href="#">codari@gmail.com</a></li>
						<li class="icon solid fa-phone">(02) 123-4567</li>
						<li class="icon solid fa-home">서울시 성북구 한성대학교 #02876<br />Korea, TN 02-760-5800</li>
					</ul>
				</section>

				<!-- Footer -->
				<footer id="footer">
					<p class="copyright">
						&copy; 2020 -
						<script>
							document.write(new Date().getFullYear());
						</script> 
						All rights reserved. <br>Demo Images: <a href="https://unsplash.com">Unsplash</a>. Design: <a href="https://html5up.net">HTML5 UP</a>.
					</p>
				</footer>
			</div>
		</div>
	</div>

	<!-- Scripts -->
	<script src="/assets/js/jquery.min.js"></script>
	<script src="/assets/js/browser.min.js"></script>
	<script src="/assets/js/breakpoints.min.js"></script>
	<script src="/assets/js/util.js"></script>
	<script src="/assets/js/main.js"></script>
</body>
<script>
$(function() {
	console.log("index.html 시작합니다.");
	$(`#btn1`).click(getTag);
	getCovidInfo();
});

function getCovidInfo(){
    $.ajax({
        type: "GET", 
        url: "/covid/covidInfo",
        async: false,
        success: function(data){
            $(`#covidInfo`).html(data);
        }
    });
}
function getTag() {
	var s = $(this).val();
	if (s == "숨기기") {
		$(this).val("보여주기").removeClass("hide").addClass("show");
		$(`div.wordCloud1`).html("");
	} else {
		$(this).val("숨기기").removeClass("show").addClass("hide");
		$(`#desc`).append("<p>실시간 뉴스 태그를 받아오는 중입니다.. <br>(예상 소요 시간 : 약 45초)</p>");
		setTimeout(function() {
			$.when(responseJSOUP()).done(function() {
				$(`div#desc>p`).remove();
				console.log("index.html 끝났습니다.");
			});
		}, 1000);
	}
}

function responseJSOUP() {
	$.ajax({
		type		: 'GET',
		dataType	: 'html',
		async		: false,
		url			: '/word-cloud/jsoupData',
		success		: function(data) {
			var jsons = JSON.parse(data);
			$(`#wordCloud`).html(data);
			wordCloudStart(jsons)
		},
		error		: function(e) {
			console.log("데이터를 불러오지 못하였습니다.");
		}
	});
}
var color = d3.scale.linear()
.domain([0,1,2,3,4,5,6,10,15,20,100])
.range(["#ddd", "#ccc", "#bbb", "#aaa", "#999", "#888", "#777", "#666", "#555", "#444", "#333", "#222"]);
function wordCloudStart(data) {
	d3.layout.cloud().size([800, 300])
	.words(data)
	.padding(1)
	.rotate(function() { return 0; })
	.fontSize(function(d) { return d.size; })
	.on("end", draw)
	.start();
	console.log("워드 클라우드 불러옵니다.");
}
function draw(words) {
	d3.select("#wordCloud2").append("svg")
	.attr("width", 850)	
	.attr("height", 350)
	.attr("class", "wordcloud")
	.append("g")
	.attr("transform", "translate(320,200)")
	.selectAll("text")
	.data(words)
	.enter().append("text")
	.style("font-size", function(d) { return ( d.size ) + "px"; })
	.style("fill", function(d, i) { return color(i); })
	.attr("transform", function(d) {
		return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
	})
	.text(function(d) { return d.text; });
}
</script>
</html>